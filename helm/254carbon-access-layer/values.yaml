# Default values for 254carbon-access-layer
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  imageRegistry: ghcr.io/254carbon
  imagePullSecrets: []
  storageClass: ""

# Namespace configuration
namespace:
  name: 254carbon-access
  create: true

# Gateway service configuration
gateway:
  enabled: true
  replicaCount: 3
  image:
    repository: gateway
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Streaming service configuration
streaming:
  enabled: true
  replicaCount: 2
  image:
    repository: streaming
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8001
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Auth service configuration
auth:
  enabled: true
  replicaCount: 2
  image:
    repository: auth
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8010
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "250m"
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 6
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Entitlements service configuration
entitlements:
  enabled: true
  replicaCount: 2
  image:
    repository: entitlements
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8011
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 6
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Metrics service configuration
metrics:
  enabled: true
  replicaCount: 1
  image:
    repository: metrics
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8012
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

# Redis configuration
redis:
  enabled: true
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"

# PostgreSQL configuration
postgresql:
  enabled: true
  auth:
    postgresPassword: "access"
    username: "access"
    password: "access"
    database: "access"
  primary:
    persistence:
      enabled: true
      size: 5Gi
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# Kafka configuration
kafka:
  enabled: true
  replicaCount: 1
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  zookeeper:
    replicaCount: 1
    persistence:
      enabled: true
      size: 5Gi
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# Monitoring configuration
monitoring:
  enabled: true
  prometheus:
    enabled: true
    persistence:
      enabled: true
      size: 10Gi
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
  grafana:
    enabled: true
    adminPassword: "admin123"
    persistence:
      enabled: true
      size: 5Gi
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.254carbon.local
      paths:
        - path: /
          pathType: Prefix
          service: gateway
    - host: stream.254carbon.local
      paths:
        - path: /ws
          pathType: Prefix
          service: streaming
        - path: /sse
          pathType: Prefix
          service: streaming
  tls:
    - secretName: access-layer-tls
      hosts:
        - api.254carbon.local
        - stream.254carbon.local

# Configuration
config:
  environment: "production"
  logLevel: "info"
  enableTracing: true
  traceSamplingRate: 0.1
  redisUrl: "redis://redis-master:6379/0"
  postgresDsn: "postgresql://access:access@postgresql:5432/access"
  kafkaBootstrap: "kafka:9092"
  jwksUrl: "http://keycloak-service:8080/realms/254carbon/protocol/openid-connect/certs"
  authServiceUrl: "http://auth-service:8010"
  entitlementsServiceUrl: "http://entitlements-service:8011"
  metricsServiceUrl: "http://metrics-service:8012"
  otelExporter: "http://otel-collector:4318"

# Security
security:
  podSecurityContext:
    fsGroup: 2000
  containerSecurityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 1000
    capabilities:
      drop:
        - ALL

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Network policies
networkPolicy:
  enabled: false

# Pod monitoring
podMonitor:
  enabled: false

# Service monitor
serviceMonitor:
  enabled: false
